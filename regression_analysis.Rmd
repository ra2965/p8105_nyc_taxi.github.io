---
title: "regression analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r }
library(tidyverse)
library(ggplot2)
library(PerformanceAnalytics)
library(mctest)
library(ppcor)

pilot = read.csv("./data/pilot.csv")
taxi_zone_lookup = read.csv("./data/taxi_zone_lookup.csv")
weather_nyc_2018 = read.csv("./data/weather_nyc_2018.csv")


  
reg_sample = pilot %>% 
  mutate(
    duration = case_when(
    pu_date != do_date ~ do_min - pu_min + (60 *(do_hour - pu_hour + 24)),
    pu_date == do_date ~ do_min - pu_min + (60 *(do_hour - pu_hour) )

  ),
      tip_percent = tip_amount/fare_amount
  ) %>% 
  filter(fare_amount != 0,
         fare_amount != 52,#We find that there might be an entry error since all records that fare_amount is 52 have different distance and duration#
         tip_amount != 0,
         duration <= 360)

reg_plot = reg_sample %>% 
  sample_frac(size = 0.1, replace = FALSE)
 
reg_plot %>% 
  ggplot(aes(x = trip_distance, y = fare_amount)) +
  geom_point(alpha = 0.3, color = 'blue') 



```



```{r }
reg_plot %>% 
  ggplot(aes(x = duration, y = fare_amount)) +
  geom_point(alpha = 0.3, color = 'red')
```


```{r }
fit1 = lm(fare_amount ~ duration + trip_distance , data = reg_sample ) %>% 
  broom::tidy() %>% 
  janitor::clean_names() %>% 
  mutate(p = round(p_value,3))

fit1 = lm(fare_amount ~ duration + trip_distance , data = reg_sample ) 
summary(fit1)
```


```{r}
par(mfrow=c(2,2))
plot(fit1)

```

```{r }
diagnostics = reg_sample %>% 
  select(trip_distance, duration, fare_amount)
X = diagnostics %>% 
  select(trip_distance, duration)

omcdiag(X,reg_sample$fare_amount)
```
The calculated value of the Chi-square test statistic is found to be 63761.5711 and it is highly significant thereby implying the presence of multicollinearity in the model specification.


This induces us to go for the next step of Farrar – Glauber test (F – test) for the location of the multicollinearity.
```{r }
imcdiag(X, diagnostics$fare_amount)

```

The VIF, TOL and Wi columns provide the diagnostic output for variance inflation factor, tolerance and Farrar-Glauber F-test respectively. 
```{r }
pcor(X, method = "pearson")

```  
  






