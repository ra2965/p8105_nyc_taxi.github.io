<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Raw Data Tidy</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="raw_data_tidy.html">Data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="10_year_overall_analysis.html">Overall</a>
    </li>
    <li>
      <a href="2018_Trip_Pattern.html">Trip Pattern</a>
    </li>
    <li>
      <a href="10_year_overall_analysis.html">Overall Analysis across 10 Years</a>
    </li>
  </ul>
</li>
<li>
  <a href="project_report.html">Project Report</a>
</li>
<li>
  <a href="mailto:&lt;ra2965@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/ra2965/p8105_nyc_taxi.github.io">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Raw Data Tidy</h1>

</div>


<div id="raw-data-explanation" class="section level2">
<h2>1. Raw Data Explanation</h2>
<ul>
<li><p><strong>NYC Weather Data:</strong> The weather of New York City (NYC) in 2018 raw data is from the <a href="https://www.ncdc.noaa.gov/data-access/land-based-station-data/land-based-datasets/global-historical-climatology-network-ghcn">Global Historical Climatology Network’s daily data (GHCND)</a>. This dataset can be downloaded by <code>rnoaa::meteo_pull_monitors</code>.</p></li>
<li><p><strong>NYC Yellow Taxi Data:</strong> The NYC yellow taxi raw data is from the <a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">TLC TriP Record Data</a>. It contains all the yellow taxi trip records in NYC from 2009 to 2019. First, to analyze change of the NYC yellow taxi use across 10 years, we focus on Yellow Taxi Trip Records raw data in every month of 2009, 2011, 2013, 2015, 2017. Next, to analyze change of the NYC yellow taxi use in detail, we focus on the yeat of 2018 and generate randomly sampled sub-datasets for each month in 2018. Because the raw data is too large, we put it in a folder named <em>raw_data</em> and added it to the <code>.gitignore</code> file. So the <em>raw_data</em> folder was not uploaded to the Github. The monthly sub-datasets were generated by randomly sampling 100,000 observations from each month of 2018 and saved in the folder <em>data</em>.</p></li>
</ul>
</div>
<div id="datasets-generation-and-cleaning" class="section level2">
<h2>2. Datasets Generation and Cleaning</h2>
<p>Because the raw data is too large (over 100GB), all the code chunks below are set as <code>eval = FALSE</code> after we generate sub-datasets that we need so that this Rmd file can be knitted.</p>
<div id="nyc-weather-dataset" class="section level4">
<h4>2.1 NYC Weather Dataset</h4>
<p>The code chunk below generates the NYC weather dataset <code>weather_df</code> containing daily temperature and precipitation in NYC 2018 and saves the dataset as <em><strong>weather_nyc_2018.csv</strong></em> in the folder <em><strong>data</strong></em>.</p>
<pre class="r"><code>weather_df = 
  rnoaa::meteo_pull_monitors(
    c(&quot;USW00094728&quot;),
    var = c(&quot;PRCP&quot;, &quot;TMIN&quot;, &quot;TMAX&quot;), 
    date_min = &quot;2018-01-01&quot;,
    date_max = &quot;2018-12-31&quot;) %&gt;%
  mutate(
    name = recode(id, USW00094728 = &quot;CentralPark_NY&quot;),
    tmin = tmin / 10,
    tmax = tmax / 10) %&gt;%
  select(name, id, everything())

write.csv(weather_df, &quot;./data/weather_nyc_2018.csv&quot;, row.names = FALSE)</code></pre>
</div>
<div id="monthly-nyc-yellow-taxi-trip-datasets-in-2018" class="section level4">
<h4>2.2 Monthly NYC Yellow Taxi Trip Datasets in 2018</h4>
<p>The code chunk below generates the 12 NYC yellow taxi datasets with 100,000 observations randomly sampled from the yellow taxi records in each month of 2018, and saves the datasets <em><strong>yellow_tripdata_2018_month</strong></em> in the folder <em><strong>data</strong></em>. These datasets are used for detailed analysis of the NYC yellow taxi use within a year. The code chunk below also generates a file having daily total number of taxi orders named as <em><strong>2018_taxi_trip_daily_summary</strong></em> in the folder <em><strong>data</strong></em>.</p>
<pre class="r"><code>set.seed(1)

file_name = list.files(path = &quot;raw_data&quot;, pattern = &quot;2018&quot;)

taxi_trip_2018_df = map(.x = file_name, ~ read_csv(str_c(&quot;raw_data/&quot;, .x)))

taxi_trip_2018_df_sampled = 
  taxi_trip_2018_df %&gt;% 
  map(.x = ., ~janitor::clean_names(.x)) %&gt;% 
  map(.x = ., ~sample_n(.x, 100000)) %&gt;% 
  map(.x = ., ~arrange(.x, tpep_pickup_datetime))

map2(.x = taxi_trip_2018_df_sampled, .y = file_name, ~write.csv(.x, str_c(&quot;./data/&quot;, .y)), row.names = FALSE)  

taxi_trip_2018_df_summary = 
  taxi_trip_2018_df %&gt;%
  map(.x = ., ~mutate(.x, date = as.Date(.x$tpep_pickup_datetime))) %&gt;%
  map(.x = ., ~select(.x, date)) %&gt;%
  map(.x = ., ~count(.x, vars = date)) %&gt;% 
  bind_rows()

taxi_trip_2018_df_summary = filter(taxi_trip_2018_df_summary, n &gt; 10000)
    
write.csv(taxi_trip_2018_df_summary, &quot;./data/yearly_summary/2018_taxi_trip_daily_summary.csv&quot;)</code></pre>
</div>
<div id="yearly-nyc-yellow-taxi-trip-datasets-between-2009-and-2017." class="section level4">
<h4>2.3 Yearly NYC Yellow Taxi Trip Datasets between 2009 and 2017.</h4>
<p>The code chunk below generates yearly NYC yellow taxi datasets (rides, passengers, fares etc.) from the yellow taxi records in 2009, 2011, 2013, 2015, 2017, and saves the datasets in the folder <em><strong>data</strong></em>. These datasets are used for general analysis of the NYC yellow taxi use in the past 10 years.Because the data is over 100GB and our computer can’t handle it all at once, we generate datasets year by year instead importing all of them once.</p>
<pre class="r"><code>file_name = list.files(path = &quot;raw_data&quot;, pattern = &quot;2017&quot;)

taxi_trip_2017_df = map(.x = file_name, ~ read_csv(str_c(&quot;raw_data/&quot;, .x)))

taxi_trip_2017_df_summary = 
  taxi_trip_2017_df %&gt;% 
  map(.x = ., 
      ~summarise(.x, total_ride = nrow(.), total_passenger = sum(passenger_count), total_fare = sum(total_amount), mean_fare = mean(total_amount), median_fare = median(total_amount))
  ) %&gt;% 
  bind_rows() %&gt;% 
  mutate(
    file = file_name
  ) %&gt;% 
  select(file, everything())

write.csv(taxi_trip_2017_df_summary, &quot;./data/yearly_summary/2017_taxi_trip_summary.csv&quot;)</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
