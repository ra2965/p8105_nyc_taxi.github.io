---
title: "weather and drive amount"
author: "Yuqing Xue"
date: "11/30/2019"
output: html_document
---

```{r echo=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gganimate)
library(ggplot2)
```
# Temperature and Taxi Use

Previous work has shown that there are relationships between taxi ridership and weather events.“During adverse weather, taxi drivers tend to make more money” (Kamga et al., 2013). Kamga et al. also found that during days when adverse weather took place, there was a higher demand for taxis in Manhattan compared to the other boroughs, and that more people were prone to take shorter taxi trips.


In this part, we want to see whether there is a trend between weather and yellow cab within and between months use using our data. We use the weather data including temperature and precipitation data in 2018 and their corresponding yellow taxi use data. For temperature, we use average temperature as the mean of maximum temperarure and miniminum temperature in each day. 


```{r echo=FALSE, message = FALSE, warning = FALSE}
pilot=read_csv(file = "./data/pilot.csv")
```


```{r echo=FALSE, message = FALSE, warning = FALSE}
 plot_df=pilot%>%
  mutate(
  average_temp=(tmin+tmax)/2)

cab=pilot%>%
  group_by(month)%>%count(pu_date)%>%
  mutate(daily_drive=n)%>%
  ungroup(month)

```


```{r echo=FALSE, message = FALSE, warning = FALSE}
plot_data = 
  left_join(plot_df, cab, by = c("month","pu_date"))%>%
  select(month, pu_date,average_temp, daily_drive,prcp)%>%
  mutate(month=as.factor(month),
         month=recode_factor(month, '1'="January", '2'="Feburary",'3'="March",'4'='April','5'='May','6'='June','7'='July','8'='August','9'='September','10'='October','11'='November','12'='December'))


```

Here we make an animation plot to show the daily drive amount and average daily temperature for each month.The size of the dots shows the precipitaiton for that day which help to identify whether rainy weather also increase taxi use. 

Although we hypothesis that cold weather and hot weather might have more taxi use, there is no obvious difference taxi useage for different daily temperature and no interaction between month and average temperature being observed. However, there is a slightly higher daily taxi usage in Feburary. Also, due to the limitation of pilot dataset which is generated from the raw dataset, we can't investigate the pattern between month and daily taxi usage. 

```{r echo=FALSE, message = FALSE, warning = FALSE}
weather_drive=plot_data %>%
  ggplot(aes(x=average_temp, y=daily_drive, frame_vars(month)))+
  geom_point(aes(size=prcp,colour = month))+
   labs(title = 'Month: {closest_state}',
       x = 'Daily average temperature for year 2018 ℃', 
       y = 'Daily drive amount',
       colour = 'Month',
       size='Precipitation'
       ) +
  theme(
    axis.text.y  = element_blank(),
    
  )+
  scale_y_continuous(breaks = c(0,400), 
                     labels=c("low","high")
)+
  transition_states(month,2,1)+
  enter_appear()+
  exit_fade()
   
animate(weather_drive, duration=12)
```

# Precipitation and Taxi Use

We then want to further look at the association between precipitation, as we guess that people might take more taxi in rainy days. This time, we make a panel of scatterplot for each month in 2018, with precipitation as x-axis and daily drive amount in y-axis. 

Still, there is no obvious difference in the taxi use. 
```{r echo=FALSE, message = FALSE, warning = FALSE}
precipitation=
  left_join(pilot, cab, by = c("month","pu_date"))%>%
  select(month, pu_date, prcp, daily_drive)%>%
  mutate(month=as.factor(month),
         month=recode_factor(month, '1'="January", '2'="Feburary",'3'="March",'4'='April','5'='May','6'='June','7'='July','8'='August','9'='September','10'='October','11'='November','12'='December'))

  
```

```{r echo=FALSE, message = FALSE, warning = FALSE}
prcp_drive=precipitation%>%
  ggplot(aes(x=prcp, y=daily_drive, color=month))+
  geom_point(aes(colour = month))+
   labs(title = 'Precipitation and Taxi Use in 2018',
       x = 'Daily precipitation for year 2018', 
       y = 'Daily drive amount',
       colour = 'Month'
       ) 
prcp_drive

```

 
